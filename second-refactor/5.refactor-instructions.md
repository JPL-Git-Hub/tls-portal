# TLS Portal Refactor Instructions

## Prerequisites
- Working in `tls-portal/` directory (current project)
- All work committed to git
- Classification table completed

## Step 1: Extract Patterns from "C" Files

### 1.1 Identify "C" Files
From classification table, list all files marked as "C" containing valuable patterns.

### 1.2 Extract to Documentation
For each "C" file:

**Local Development Patterns**
- Target: Update `docs/07-local-development-guide.md`
- Extract: SSL setup, port management, testing workflows

**API Testing Patterns**  
- Target: Create `docs/09-testing-guide.md`
- Extract: Endpoint testing, validation patterns, mock strategies

**Form Testing Approaches**
- Target: Update `docs/09-testing-guide.md` 
- Extract: Form validation, error handling, integration testing

**Implementation Insights**
- Target: Update relevant existing docs
- Extract: Architecture decisions, gotchas, performance notes

### 1.3 Archive Extracted Files
```bash
mkdir -p archive/extracted-patterns-$(date +%Y%m%d)
# Move specific "C" files after extracting their patterns
```

## Step 2: Verify Script Generation

### 2.1 Test Current Scripts
```bash
./scripts/init-all.sh --dry-run
```

### 2.2 Check Script Coverage
Ensure init scripts exist for all "A" classified modules:
- Check `scripts/init-module-*.sh` files
- Identify missing or incomplete scripts

## Step 3: Clean Architecture

### 3.1 Remove "D" Files
```bash
# System files
find . -name ".DS_Store" -delete

# Build artifacts
rm -rf dist/ src/*/dist/ node_modules/ src/*/node_modules/

# Local environment (backup first!)
cp .env .env.backup 2>/dev/null || echo "No .env to backup"
rm -f .env

# Other temporary files as identified in classification
```

## Step 4: Validation

### 4.1 Fresh Generation Test
```bash
# Clean and regenerate
./scripts/init-all.sh

# Test functionality
yarn install
./scripts/dev.sh
```

### 4.2 Documentation Review
- [ ] All patterns extracted to docs
- [ ] Setup instructions accurate
- [ ] No broken references

## Step 5: Archive and Finalize

### 5.1 Create Archive (After Refactor Complete)
```bash
cd ..
cp -r tls-portal/ tls-portal-archive-$(date +%Y%m%d-%H%M%S)/
cd tls-portal/
```

### 5.2 Commit Clean Architecture
```bash
git add .
git commit -m "Complete refactor: extract patterns, clean architecture"
```

## Validation Checklist
- [ ] All "C" files extracted to documentation
- [ ] All "D" files removed  
- [ ] All "A" files can be regenerated via scripts
- [ ] All "B" files preserved in correct locations
- [ ] Project builds and runs successfully
- [ ] Setup time under 30 minutes
- [ ] No functionality lost
- [ ] Archive created after refactor completion

## Notes
- Archive timing: AFTER refactor is complete
- Result: Clean `tls-portal/` with script-based architecture
- Keep archive for reference